!function(){var e={}.hasOwnProperty;this.Mercury.Toolbar.Button=function(){function t(e,t,n,i,s){return this.name=e,this.title=t,this.summary=null!=n?n:null,this.types=null!=i?i:{},this.options=null!=s?s:{},this.title&&(this.title=Mercury.I18n(this.title)),this.summary&&(this.summary=Mercury.I18n(this.summary)),this.build(),this.bindEvents(),this.element}return t.prototype.build=function(){var t,n,i,s,r,l;this.element=jQuery("<div>",{title:null!=(s=this.summary)?s:this.title,"class":"mercury-button mercury-"+this.name+"-button"}).html("<em>"+this.title+"</em>"),this.element.data("expander",'<div class="mercury-expander-button" data-button="'+this.name+'"><em></em><span>'+this.title+"</span></div>"),this.handled={},r=this.types,l=[];for(i in r)if(e.call(r,i))switch(t=r[i],i){case"preload":l.push(!0);break;case"regions":this.element.addClass("disabled"),l.push(this.handled[i]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"toggle":l.push(this.handled[i]=!0);break;case"mode":l.push(this.handled[i]=t===!0?this.name:t);break;case"context":l.push(this.handled[i]=jQuery.isFunction(t)?t:Mercury.Toolbar.Button.contexts[this.name]);break;case"palette":this.element.addClass("mercury-button-palette"),n=jQuery.isFunction(t)?t.call(this,this.name):t,l.push(this.handled[i]="string"==typeof n?new Mercury.Palette(n,this.name,this.defaultDialogOptions()):n);break;case"select":this.element.addClass("mercury-button-select").find("em").html(this.title),n=jQuery.isFunction(t)?t.call(this,this.name):t,l.push(this.handled[i]="string"==typeof n?new Mercury.Select(n,this.name,this.defaultDialogOptions()):n);break;case"panel":this.element.addClass("mercury-button-panel"),this.handled.toggle=!0,n=jQuery.isFunction(t)?t.call(this,this.name):t,l.push(this.handled[i]="string"==typeof n?new Mercury.Panel(n,this.name,this.defaultDialogOptions()):n);break;case"modal":l.push(this.handled[i]=jQuery.isFunction(t)?t.call(this,this.name):t);break;case"lightview":l.push(this.handled[i]=jQuery.isFunction(t)?t.call(this,this.name):t);break;default:throw Mercury.I18n('Unknown button type "%s" used for the "%s" button.',i,this.name)}return l},t.prototype.bindEvents=function(){var e=this;return Mercury.on("button",function(t,n){return n.action===e.name?e.element.click():void 0}),Mercury.on("mode",function(t,n){return e.handled.mode===n.mode&&e.handled.toggle?e.togglePressed():void 0}),Mercury.on("region:update",function(t,n){var i;return e.handled.context&&n.region&&"function"===jQuery.type(n.region.currentElement)?(i=n.region.currentElement(),i.length&&e.handled.context.call(e,i,n.region.element)?e.element.addClass("active"):e.element.removeClass("active")):e.element.removeClass("active")}),Mercury.on("region:focused",function(t,n){return e.handled.regions&&n.region&&n.region.type()?e.handled.regions.indexOf(n.region.type())>-1?e.element.removeClass("disabled"):e.element.addClass("disabled"):void 0}),Mercury.on("region:blurred",function(){return e.handled.regions?e.element.addClass("disabled"):void 0}),this.element.on("mousedown",function(){return e.element.addClass("active")}),this.element.on("mouseup",function(){return e.element.removeClass("active")}),this.element.on("click",function(t){return e.element.closest(".disabled").length?void 0:e.handleClick(t)})},t.prototype.handleClick=function(t){var n,i,s,r;n=!1,r=this.handled;for(s in r)if(e.call(r,s))switch(i=r[s],s){case"toggle":this.handled.mode||this.togglePressed();break;case"mode":n=!0,Mercury.trigger("mode",{mode:i});break;case"modal":n=this.handleModal(t);break;case"lightview":n=this.handleLightview(t);break;case"palette":case"select":case"panel":n=this.handleDialog(t,s)}return n||Mercury.trigger("action",{action:this.name}),this.options.regions&&this.options.regions.length?Mercury.trigger("focus:frame"):void 0},t.prototype.handleModal=function(){return Mercury.modal(this.handled.modal,{title:this.summary||this.title,handler:this.name}),!0},t.prototype.handleLightview=function(){return Mercury.lightview(this.handled.lightview,{title:this.summary||this.title,handler:this.name,closeButton:!0}),!0},t.prototype.handleDialog=function(e,t){return e.stopPropagation(),this.handled[t].toggle(),!0},t.prototype.defaultDialogOptions=function(){return{title:this.summary||this.title,preload:this.types.preload,appendTo:this.options.appendDialogsTo||"body",closeButton:!0,"for":this.element}},t.prototype.togglePressed=function(){return this.element.toggleClass("pressed")},t}(),this.Mercury.Toolbar.Button.contexts={backColor:function(e){return this.element.css("background-color",e.css("background-color"))},foreColor:function(e){return this.element.css("background-color",e.css("color"))},bold:function(e){var t;return t=e.css("font-weight"),"bold"===t||t>400},italic:function(e){return"italic"===e.css("font-style")},overline:function(e){var t,n,i,s;if("overline"===e.css("text-decoration"))return!0;for(s=e.parentsUntil(this.element),n=0,i=s.length;i>n;n++)if(t=s[n],"overline"===jQuery(t).css("text-decoration"))return!0;return!1},strikethrough:function(e,t){return"line-through"===e.css("text-decoration")||!!e.closest("strike",t).length},underline:function(e,t){return"underline"===e.css("text-decoration")||!!e.closest("u",t).length},subscript:function(e,t){return!!e.closest("sub",t).length},superscript:function(e,t){return!!e.closest("sup",t).length},justifyLeft:function(e){return e.css("text-align").indexOf("left")>-1},justifyCenter:function(e){return e.css("text-align").indexOf("center")>-1},justifyRight:function(e){return e.css("text-align").indexOf("right")>-1},justifyFull:function(e){return e.css("text-align").indexOf("justify")>-1},insertOrderedList:function(e,t){return!!e.closest("ol",t.element).length},insertUnorderedList:function(e,t){return!!e.closest("ul",t.element).length}}}.call(this);