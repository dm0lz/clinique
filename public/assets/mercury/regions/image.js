!function(){var e={}.hasOwnProperty,r=function(r,t){function n(){this.constructor=r}for(var i in t)e.call(t,i)&&(r[i]=t[i]);return n.prototype=t.prototype,r.prototype=new n,r.__super__=t.prototype,r};this.Mercury.Regions.Image=function(e){function t(e,r,n){this.element=e,this.window=r,this.options=null!=n?n:{},t.__super__.constructor.apply(this,arguments)}var n;return r(t,e),t.supported=document.getElementById,t.supportedText="Chrome 10+, Firefox 4+, IE 7+, Safari 5+, Opera 8+",n="image",t.prototype.type=function(){return n},t.prototype.bindEvents=function(){var e=this;return Mercury.on("mode",function(r,t){return"preview"===t.mode?e.togglePreview():void 0}),Mercury.on("focus:frame",function(){return e.previewing||Mercury.region!==e?void 0:e.focus()}),Mercury.on("action",function(r,t){return e.previewing||Mercury.region!==e?void 0:t.action?e.execCommand(t.action,t):void 0}),this.element.on("dragenter",function(r){return e.previewing?void 0:(r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("dragover",function(r){return e.previewing?void 0:(r.preventDefault(),r.originalEvent.dataTransfer.dropEffect="copy")}),this.element.on("drop",function(r){return e.previewing?void 0:r.originalEvent.dataTransfer.files.length?(r.preventDefault(),e.focus(),Mercury.uploader(r.originalEvent.dataTransfer.files[0])):void 0}),this.element.on("focus",function(){return e.focus()})},t.prototype.togglePreview=function(){return this.previewing?(this.previewing=!1,this.element.attr(Mercury.config.regions.attribute,n),this.build()):(this.previewing=!0,this.element.removeAttr(Mercury.config.regions.attribute),Mercury.trigger("region:blurred",{region:this}))},t.prototype.focus=function(){return this.previewing?void 0:(Mercury.region=this,Mercury.trigger("region:focused",{region:this}),Mercury.trigger("region:update",{region:this}))},t.prototype.execCommand=function(e,r){var n;return null==r&&(r={}),t.__super__.execCommand.apply(this,arguments),(n=Mercury.Regions.Image.actions[e])?n.call(this,r):void 0},t.prototype.pushHistory=function(){return this.history.push({src:this.element.attr("src")})},t.prototype.updateSrc=function(e){return this.element.attr("src",e)},t.prototype.serialize=function(){return{type:n,data:this.dataAttributes(),attributes:{src:this.element.attr("src")}}},t.actions={undo:function(){var e;return(e=this.history.undo())?this.updateSrc(e.src):void 0},redo:function(){var e;return(e=this.history.redo())?this.updateSrc(e.src):void 0},insertImage:function(e){return this.updateSrc(e.value.src)}},t}(Mercury.Region)}.call(this);